So it's [[four_years|The_deprecated_SDcard]] since my last Android post. Ever
since I was given a "free" iPhone from my workplace at the time, all those years
ago, I decided to switch to IOS and I've been a happy camper ever since.

As people will testify who know me, I not an Android fan. Usability is poor and
I'm a Java language hater. Nonetheless I've set myself a challenge to explore &
develop a Webconverger port. The source code won't be public, though I will
make efforts to document my efforts here.

## 2015-01-11

I want **Android 5** and I need a device. If my memory at Aplix serves me
correctly, running AVD emulator on my aging X220 would be madness.

<a href="https://www.flickr.com/photos/hendry/16254776355" title="Nexus 7 running lollipop aka Android 5 by Kai Hendry, on Flickr"><img src="https://farm9.staticflickr.com/8661/16254776355_2bd458127b_n.jpg" width="240" height="320" alt="Nexus 7 running lollipop aka Android 5"></a>

So I bought a second hand Nexus 7 for 200SGD off <https://carousell.co/>. I'm happy with it.

First impressions of setting up the device is that the wireless "password" prompt is jarringly wrapped. UGLY!

It seems the device is unusable without logging into Google. Tbh I don't use
Gmail anymore and I don't want it to download my old email, nonetheless it went
ahead and did it. :( I'm logged into Youtube, but it seems like I need to
separately log into the Play store et al. What the hell!?

Not sure how I would ever use this device myself in my daily life. Ok, maybe
for watching Youtube videos in bed? :)

So far nothing impresses me about the device. I thought there was a VOIP
client, but I can't find it. Seems like I have to use the [proprietary Google
Hangout](https://en.wikipedia.org/wiki/Google_Hangouts).

## 2015-01-12

<img src=http://s.natalian.org/2015-01-12/lib32-android-studio.png alt="lib32 fugliness">

I've earmarked today to setup the [Android development environment on
Archlinux](https://wiki.archlinux.org/index.php/android#Android_Studio). Bonus
points if I manage a Hello World app.

Got android-studio installed after enabling multilib. Why is it 32 bit is beyond me. Especially considering the RAM it consumes.

	Optional dependencies for android-studio
		android-sdk
		android-sdk-platform-tools
		android-sdk-build-tools

<https://bugs.archlinux.org/task/43418?project=1&cat%5B0%5D=2&string=java-runtime-common>

I had some corrupt JDK since I ran out of disk space on /tmp, hence [I wasted some time](https://bugs.archlinux.org/task/43418?project=1&cat%5B0%5D=2&string=java-runtime-common). OpenJDK was unstable with crap outs like `systemd-coredump[20156]: Process 7039 (java) of user 1000 dumped core`. The Oracle JDK works better since I think it's compiled against a newer libc from what I was reading after a frantic Google session.

	x220:~$ sudo archlinux-java status
	Available Java environments:
	  java-8-jdk (default)
	  java-8-jre/jre
	  java-8-openjdk

Worryingly, selecting to create a new project takes seriously 5 minutes of frantic downloading. Scary: <http://r2d2.webconverger.org/2015-01-12/gradle.mp4>

Android studio seems to going mental with "Unregistered Vcs root detected" with
the fact the my homedir is in Git. Configure doesn't seem to point out where my
Project lives. I think I've resolved this now.

<blockquote class="twitter-tweet" lang="en"><p>Is this how <a href="https://twitter.com/Android">@Android</a> Studio really works? Spawning zillions of Java VMs ? <a href="http://t.co/s4froaYKQt">http://t.co/s4froaYKQt</a> :/</p>&mdash; Kai Hendry (@kaihendry) <a href="https://twitter.com/kaihendry/status/554587440871006208">January 12, 2015</a></blockquote>
<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>

Both `wmname LG3D` and `export _JAVA_AWT_WM_NONREPARENTING=1` seems to be
needed to make android-studio behave with [dwm](http://dwm.suckless.org/).

<img width=500 src=http://s.natalian.org/2015-01-12/helloworld.png alt="Got my Android dev environment going!">

## 2015-01-13

First, many thanks to [Wyemun](https://github.com/wyemun) for answering several of my questions.

Things I don't understand about IntelliJ. How to reformat my buffer? (Update:
2015-01-15 Ctrl-Alt-L, Return) Why is finding a class for an import so bloody
slow / not working at time? It makes `goimports` look like genius. How do I
search all the files in a project?

Not sure how Android documentation is organised. Took me hours to find:

<http://developer.android.com/reference/android/app/ActivityManager.html#isInLockTaskMode()> was the way you test <http://developer.android.com/reference/android/app/Activity.html#startLockTask()> is active. Why isn't there a cross reference from `startLockTask`?!?!?!

Furthermore, to be able to query this property, you need to grossly verbose
instantiation: `ActivityManager activityManager = (ActivityManager)
this.getSystemService(Context.ACTIVITY_SERVICE);` Is this normal??!

Creating a URL in Java is a bit weird. Seems to bizarrely demand a try..catch. Really starting to appreciate Golang's [error handling model](http://blog.golang.org/errors-are-values).

So bundles, IIUC, are Android's version of
[localStorage](https://html.spec.whatwg.org/multipage/webstorage.html#the-localstorage-attribute)?
I'm getting to grips with the Android lifecycle and it means saving state
manually between onCreate AFAICT. Haven't quite got a good mental model. TODO: <http://developer.android.com/training/basics/activity-lifecycle/>

### WebView

Why doesn't it prompt that it needs the **android.permission.INTERNET** permission in the IntelliJ (Android Studio) IDE?

Odd how you need to explicitly enable Javascript in the WebView and make links clickable. Why aren't these defaults?

Odd to me, that WebView's `loadUrl` wants a string, not a URL object.

## 2015-01-14

I wish there was a way taking a video capture like you can with IOS attached to
a MBP with Quicktime player "Movie recording".

Had this scary [Default Activity not found](http://stackoverflow.com/questions/18828654/default-activity-not-found-in-android-studio). Restarting Android Studio 1.0.2 fixed it for me.

<http://romannurik.github.io/AndroidAssetStudio/icons-launcher.html> confusingly [generates PNGs with a **mipmap** directory prefix](https://github.com/romannurik/AndroidAssetStudio/issues/38) instead of drawable. WTH. Ok, spending way way too long trying to setup the icons. Sheesh

Bizaare to me that Android just doesn't use SVG and let the SDK build out the PNGs as needed. Whacky.

Annoyingly [romannurik](https://github.com/romannurik) who pissed me off with `s,@drawable,@mipmap,` (nevermind all the stock ic_launcher.pngs) change fronts a [video explaining how to do Android immersive mode](https://www.youtube.com/watch?v=cBi8fjv90E4). Maybe it was because I was upset with him, but I didn't get it. Bit silly how hard it is to hide the {action,status} bar until the App is interacted with.

## 2015-01-15

Today, my mission is to understand how [Device Administrator](http://s.natalian.org/2015-01-15/device-administrator.png) works.

1. http://android.stackexchange.com/a/85125/90140
2. http://stackoverflow.com/questions/26467321
3. https://code.google.com/p/android-developer-preview/issues/detail?id=1646

It seems that you can only setup an [Android Lollipop device with NFC](http://developer.android.com/about/versions/android-5.0.html#Enterprise). A tad bizarre. This means you need at least two NFC capable Android devices. That run Lollipop. Hmmm, Ok.

After a frantic 1-2hr coding session, I managed to root the device and further lock down the App by establishing Device Administrator. Some puzzles remain:

* How to disable Device Administrator? Bizarrely uninstalling the App doesn't work. <http://s.natalian.org/2015-01-15/still-admin.png>
* If the device is powered off, which is quite possible to do when mounted in a public environment, it doesn't return to the (locked) app. Oh dear.
